<!DOCTYPE html>

<!--Alunos: Guilherme Santana Diogo e Paulo César Nogueira-->

<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - IOT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Estilos mínimos para cores das vagas -->
    <style>
        /*CONFIGURAÇÃO CORES*/


        :root {
            --primary: #7A8794;
            --accent: #E0D83D;
            --neutral: #989892;
            --bg-light: #FFFFFF;
            --text-light: #FFFFFF;
            --text-dark: #333333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .conteudo {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        h1,
        h2 {
            color: var(--primary);
            margin-bottom: 15px;
        }

        h1 {
            font-size: 2.2rem;
        }

        h2 {
            font-size: 1.6rem;
            border-bottom: 2px solid var(--neutral);
            padding-bottom: 5px;
        }

        /* BARRA DE NAVEGAÇÃO*/

        .barra-navegacao {
            background-color: var(--primary);
            color: var(--text-light);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }


        .links-navegacao {
            list-style: none;
            display: flex;
        }


        .links-navegacao li {
            margin-left: 25px;
        }


        .links-navegacao a {
            text-decoration: none;
            color: var(--text-light);
            font-weight: 500;
            padding-bottom: 5px;
            transition: color 0.3s ease, border-bottom 0.3s ease;
        }

        .links-navegacao a:hover,
        .links-navegacao a.ativo {
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
        }


        .status-sistema {
            font-size: 0.9rem;
        }


        .status-sistema span {
            color: var(--accent);
            font-weight: 700;
        }

        /*CARTÕES DE RESUMO*/


        .cartoes-resumo {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }


        .cartao {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-left: 5px solid var(--neutral);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }


        .cartao h2 {
            border-bottom: none;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: var(--neutral);
            text-transform: uppercase;
            font-weight: 700;
        }


        .cartao .contagem {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1.2;
        }


        .cartao .cartao-subtitulo {
            font-size: 0.9rem;
            color: #555;
        }

        /* Personalizando cores dos cartões */


        .cartao.cartao-livre .contagem {
            color: var(--accent);
        }

        .cartao.cartao-livre {
            border-left-color: var(--accent);
        }


        .cartao.cartao-ocupado .contagem {
            color: var(--primary);
        }

        .cartao.cartao-ocupado {
            border-left-color: var(--primary);
        }


        .cartao.cartao-taxa .contagem {
            color: var(--neutral);
        }

        /*MAPA DE VAGAS*/


        .mapa-estacionamento {
            margin-top: 40px;
        }


        .legenda {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }


        .item-legenda {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }


        .item-legenda span {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }


        .item-legenda .caixa-livre {
            background-color: var(--accent);
        }

        .item-legenda .caixa-ocupada {
            background-color: var(--primary);
        }

        /* Grid de vagas */

        .grid-vagas {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }


        .vaga-estacionamento {
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            font-weight: 700;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: default;
            border: 2px solid transparent;
        }


        .vaga-estacionamento:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }


        .vaga-estacionamento .id-vaga {
            display: block;
            font-size: 1.5rem;
        }

        .vaga-estacionamento .status-vaga {
            display: block;
            font-size: 0.9rem;
            opacity: 0.8;
            text-transform: uppercase;
        }

        /* ESTADO: LIVRE */
        .vaga-estacionamento.livre {
            background-color: var(--accent);
            color: var(--primary);
            border-color: #c7c136;
        }

        /* ESTADO: OCUPADO */
        .vaga-estacionamento.ocupada {
            background-color: var(--primary);
            color: var(--text-light);
            border-color: #606b75;
        }


        /*RODAPÉ*/
        footer {
            background-color: var(--neutral);
            color: var(--bg-light);
            text-align: center;
            padding: 1.5rem;
            margin-top: 40px;
        }

        /* CELULAR*/
        @media (max-width: 768px) {
            .barra-navegacao {
                flex-direction: column;
                gap: 15px;
            }

            .links-navegacao {
                width: 100%;
                justify-content: center;
            }

            .cartoes-resumo {
                grid-template-columns: 1fr;
            }

            .grid-vagas {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            h1 {
                font-size: 1.8rem;
            }
        }

        .vaga-estacionamento {
            display: inline-block;
            padding: 12px;
            border-radius: 6px;
            color: #222;
            min-width: 120px;
            text-align: center;
            margin: 6px;
        }

        .vaga-estacionamento.livre {
            background: #FFD54F;
        }

        /* amarelo */
        .vaga-estacionamento.ocupada {
            background: #BDBDBD;
        }

        /* cinza */
        .caixa-livre {
            display: inline-block;
            width: 14px;
            height: 14px;
            background: #FFD54F;
            margin-right: 6px;
            border-radius: 2px;
            vertical-align: middle;
        }

        .caixa-ocupada {
            display: inline-block;
            width: 14px;
            height: 14px;
            background: #BDBDBD;
            margin-right: 6px;
            border-radius: 2px;
            vertical-align: middle;
        }

        /* layout rápido para os cartões */
        .cartoes-resumo {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }

        .cartao {
            padding: 12px;
            border-radius: 8px;
            background: #f5f5f5;
            min-width: 140px;
        }

        .cartao h2 {
            margin: 0 0 8px 0;
            font-size: 14px;
        }

        .cartao .contagem {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }
    </style>
</head>

<body>

    <header>
        <nav class="barra-navegacao">
            <div class="logo">Controle de Estacionamento</div>
            <ul class="links-navegacao">
                <li><a href="/" class="ativo">Dashboard</a></li>
            </ul>
            <div class="status-sistema">
                Sistema: <span>Ligado</span>
            </div>
        </nav>
    </header>

    <main class="conteudo">
        <h1>Visão Geral do Estacionamento</h1>

        <section class="cartoes-resumo">
            <div class="cartao cartao-livre">
                <h2>LIVRES</h2>
                <p class="contagem">0</p>
                <span class="cartao-subtitulo">Vagas estão disponíveis</span>
            </div>

            <div class="cartao cartao-ocupado">
                <h2>OCUPADAS</h2>
                <p class="contagem">0</p>
                <span class="cartao-subtitulo">Vagas sendo utilizadas</span>
            </div>

            <div class="cartao cartao-taxa">
                <h2>Percentual</h2>
                <p class="contagem">0%</p>
                <span class="cartao-subtitulo">Porcentagem de vagas ocupadas</span>
            </div>
        </section>

        <section class="mapa-estacionamento">
            <h2>Mapa das Vagas</h2>

            <div class="legenda">
                <div class="item-legenda">
                    <span class="caixa-livre"></span> Livre
                </div>
                <div class="item-legenda">
                    <span class="caixa-ocupada"></span> Ocupada
                </div>
            </div>

            <div class="grid-vagas">
                <!-- apenas 1 vaga será exibida -->
                <div class="vaga-estacionamento livre">
                    <span class="id-vaga">A-01</span>
                    <span class="status-vaga">Livre</span>
                </div>
            </div>

            <!-- valor das estatísticas (lido da URL) -->
            <div class="valor-estatistica" style="margin-top:16px;">
                <h3 style="margin:0 0 6px 0; font-size:1rem; color:var(--primary);">Valor lido pelo sensor</h3>
                <p id="valor-estatistica" class="contagem" style="font-size:1.2rem; margin:0;">—</p>
            </div>
        </section>
    </main>

    <footer>
        <p>© Desenvolvido por Guilherme Santana Diogo e Paulo César Nogueira</p>
    </footer>

    <!-- Script que ajusta URL /teste/valor, contagens e cor da vaga -->
    <script>
        (function () {
            const totalVagas = 1;

            // Função assíncrona para buscar os dados do sensor
            async function buscarDadosSensor() {
                try {
                    // Requisição para a nova rota de API
                    const response = await fetch('/api/status/vaga');
                    const data = await response.json();

                    // O valor do sensor vem do JSON da API
                    const valor = data.valorSensor ? parseInt(data.valorSensor, 10) : 0;

                    // --- Lógica de Vaga Livre/Ocupada ---
                    let ocupadas = 0;
                    // Regra: se valor < 5 então 1 vaga ocupada, caso contrário 0
                    if (valor < 5) {
                        ocupadas = 1;
                    } else {
                        ocupadas = 0;
                    }

                    const livres = totalVagas - ocupadas;
                    const percentual = totalVagas > 0 ? Math.round((ocupadas / totalVagas) * 100) : 0;

                    // --- Atualiza a interface ---

                    // 1. Valor da estatística
                    const valorEstEl = document.getElementById('valor-estatistica');
                    if (valorEstEl) valorEstEl.textContent = String(valor);

                    // 2. Cartões (Livre, Ocupada, Percentual)
                    const cartoes = document.querySelectorAll('.cartoes-resumo .cartao .contagem');
                    if (cartoes && cartoes.length >= 3) {
                        cartoes[0].textContent = String(livres); // Livres
                        cartoes[1].textContent = String(ocupadas); // Ocupadas
                        cartoes[2].textContent = percentual + '%'; // Percentual
                    }

                    // 3. Vaga (Cor e Status)
                    const vaga = document.querySelector('.vaga-estacionamento');
                    if (vaga) {
                        const status = vaga.querySelector('.status-vaga');
                        if (ocupadas === 1) { // Ocupada
                            vaga.classList.remove('livre');
                            vaga.classList.add('ocupada');
                            if (status) status.textContent = 'Ocupada';
                        } else { // Livre
                            vaga.classList.remove('ocupada');
                            vaga.classList.add('livre');
                            if (status) status.textContent = 'Livre';
                        }
                    }

                } catch (error) {
                    console.error('Erro ao buscar dados do sensor:', error);
                    // Opcional: Mostrar mensagem de erro no dashboard
                }
            }

            // Executa a função imediatamente e depois a cada 3 segundos
            buscarDadosSensor();
            setInterval(buscarDadosSensor, 3000); // 3000ms = 3 segundos

        })();
    </script>

</body>

</html>